<link rel="import" href="../lrn-gitbook-sync/lrn-gitbook-sync.html">

<dom-module id="lrnapp-gitbook">
  <template>
    <style include="materializecss-styles"></style>
    <style>
      :host {
        display: block;
      }
      paper-button {
        padding: 0;
        margin: 0;
        min-width: 1rem;
      }
    </style>
      <template is="dom-if" if="[[repos]]">
        <template is="dom-repeat" items="[[repos]]">
          <lrn-gitbook-sync title="[[item.title]]" status="[[item.status]]"></lrn-gitbook-sync>
        </template>
      </template>

      <iron-ajax
        auto
        id="ajax"
        params="{{requestParams}}"
        url="[[source-path]]"
        handle-as="json"
        on-response="handleResponse"></iron-ajax>
    <!--</template>-->
  </template>

  <script>
    Polymer({
      is: 'lrnapp-gitbook',
      properties: {
        nodeId: {
          type: String
        },
        requestParams: {
          type: Object,
          value: {}
        },
        repos: {
          type: Object,
        }
      },
      observers: [
        '_nodeIdChange(nodeId)'
      ],
      listeners: {
        'gitbook-sync-clicked': '_gitbookSycnedClicked'
      },
      _gitbookSycnedClicked: function(e) {
        console.log('synced clicked', e);
      },
      _nodeIdChange: function(nodeId) {
        this.requestParams = {nodeId: nodeId};
      },
      _nodeIdIsset: function(nodeId) {
        if (nodeId) {
          return true;
        }
      },
      handleResponse: function(res) {
        let root = this;
        var response = res.detail.response.data;
        this.repos = response;
        console.log(response);
      },
      /**
       * Simple way to convert from object to array.
       */
      _toArray: function(obj) {
        return Object.keys(obj).map(function(key) {
          return obj[key];
        });
      },
    });
  </script>
</dom-module>
